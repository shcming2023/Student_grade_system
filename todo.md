# 学生成绩管理系统 TODO

## 数据库设计与实现
- [x] 设计并实现学生信息表（students）
- [x] 设计并实现班级表（classes）
- [x] 设计并实现科目表（subjects）
- [x] 设计并实现试卷模板表（exam_templates）
- [x] 设计并实现题目表（questions）
- [x] 设计并实现成绩记录表（scores）
- [x] 设计并实现成绩单表（report_cards）

## 后端API实现
- [x] 实现教师认证相关API（登录、登出、获取当前用户）
- [x] 实现学生管理API（增删改查）
- [x] 实现班级管理API（增删改查）
- [x] 实现科目管理API（增删改查）
- [x] 实现试卷模板管理API（增删改查）
- [x] 实现题目管理API（增删改查）
- [x] 实现成绩录入API（单个录入、批量录入）
- [x] 实现成绩查询API（按班级、科目、学生筛选）
- [x] 实现成绩统计API（总分、平均分、排名计算）
- [x] 实现成绩单生成API
- [ ] 实现Excel批量导入API
- [ ] 实现LLM智能分析API

## 前端界面实现
- [x] 设计并实现Dashboard布局和导航
- [x] 实现教师登录页面
- [x] 实现首页仪表盘（统计概览）
- [x] 实现学生管理页面（列表、添加、编辑、删除）
- [x] 实现班级管理页面
- [x] 实现科目管理页面
- [x] 实现试卷模板管理页面
- [ ] 实现题目管理页面
- [ ] 实现成绩录入页面（表格式录入界面）
- [ ] 实现成绩查询页面（筛选、排序、导出）
- [ ] 实现成绩单查看和导出功能
- [ ] 实现Excel批量导入界面
- [ ] 实现LLM分析报告展示页面

## 高级功能
- [ ] 实现Excel文件解析和数据映射
- [ ] 实现PDF成绩单生成
- [ ] 实现Excel成绩单导出
- [ ] 集成LLM进行成绩分析和建议生成
- [ ] 实现知识点掌握情况可视化

## 测试与优化
- [x] 编写核心功能的单元测试
- [x] 测试所有页面的交互流程
- [x] 优化界面响应速度
- [x] 检查数据一致性和完整性

## 部署准备
- [ ] 创建项目检查点
- [ ] 准备演示数据
- [ ] 编写用户使用文档

## 新增功能需求
- [x] 在试卷模板管理中添加"从现有模板复制"功能
- [x] 复制功能需要包含模板基本信息和所有题目
- [x] 允许用户在复制时修改模板名称和基本信息
- [x] 完善班级管理页面的完整CRUD功能
- [x] 完善科目管理页面的完整CRUD功能
- [ ] 实现试卷模板的题目批量添加功能

## Excel试卷导入任务
- [x] 读取并解析Excel文件的24个工作表
- [x] 为每个工作表创建对应的试卷模板
- [x] 导入每个试卷的题目信息（题号、模块、知识点、题型、分值）
- [x] 验证导入数据的完整性和正确性

## 成绩录入功能开发
- [x] 实现成绩录入相关的后端API
- [x] 创建班级和试卷模板选择器
- [x] 实现表格式成绩录入界面
- [x] 实现实时总分计算功能
- [x] 实现自动保存功能
- [x] 添加分数验证（不超过满分）
- [x] 编写成绩录入功能的单元测试

## 试卷模板详情页面
- [x] 创建试卷模板详情页面
- [x] 显示试卷基本信息（名称、科目、年级、总分）
- [x] 以表格形式展示所有题目及其详细信息（题号、模块、知识点、题型、分值）
- [x] 实现题目添加功能
- [x] 实现题目编辑功能
- [x] 实现题目删除功能
- [x] 添加路由和导航链接

## 成绩单生成和导出功能
- [x] 实现获取学生考试详细成绩的后端API
- [x] 实现按知识点和模块统计分析的API
- [x] 创建成绩单页面，包含四个部分：
  - [x] 基本信息（学生名、年级、科目）
  - [x] 成绩得分清单（按题号显示每题得分）
  - [x] 成绩分析（按知识点、按模块统计得分率）
  - [x] 教师评价区域（手写区域）
- [x] 实现PDF导出功能
- [x] 添加成绩单查询和选择界面
- [x] 编写成绩单功能的单元测试

## Mac mini M4 内网部署准备
- [x] 生成生产构建脚本
- [x] 创建环境配置文件模板
- [x] 准备数据库初始化脚本（包含24套试卷数据）
- [x] 创建启动和停止脚本
- [x] 编写详细的部署文档
- [x] 打包所有部署文件

## 系统数据关系和权限重构
### 数据库结构调整
- [x] 新增考试管理表（exam_sessions）：考试名称、学年、学期等
- [x] 修改试卷表（exams）：添加exam_session_id、出卷老师ID、阅卷老师ID
- [x] 完善教师表（teachers）：添加密码、权限角色字段
- [x] 创建试卷-学生关联表：记录哪些学生参加哪个试卷
- [x] 数据库迁移和数据兼容处理（采用渐进式策略，新字段可选）

### 教师认证和权限系统
- [x] 实现教师账号密码登录功能（后端API完成）
- [x] 实现基于角色的权限控制（后端API完成）
- [x] 初始化管理员账户（用户名：admin，默认密码：admin123）
- [x] 实现教师管理API（创建、编辑、删除、修改密码）
- [ ] 实现教师管理界面（创建账户、设置密码、分配权限）
- [ ] 修改后端API添加权限验证

### 业务流程调整
- [ ] 实现考试管理界面（创建、编辑、删除考试）
- [ ] 调整试卷创建流程（在考试下创建试卷）
- [ ] 添加试卷教师分配功能（出卷老师、阅卷老师）
- [ ] 添加试卷学生分配功能（选择参考学生）
- [ ] 根据教师角色限制功能访问（出卷老师只能维护试卷，阅卷老师只能录分）

### 前端界面调整
- [ ] 实现教师登录页面
- [ ] 调整导航菜单根据权限显示
- [ ] 实现考试管理页面
- [ ] 调整试卷管理页面（显示关联的考试、教师、学生）
- [ ] 调整成绩录入页面（阅卷老师只能看到自己负责的试卷）

## 教师登录前端实现
- [x] 创建前端认证Context（TeacherAuthContext）
- [x] 实现token持久化（localStorage）
- [x] 创建教师登录页面（用户名密码表单）
- [x] 实现登录逻辑和错误处理
- [x] 实现路由保护（未登录跳转到登录页）
- [x] 调整App.tsx添加登录路由
- [x] 更新DashboardLayout支持教师认证
- [x] 测试登录流程

## 教师管理页面开发
- [x] 完善后端API（重置密码功能）
- [x] 创建教师管理页面组件
- [x] 实现教师列表展示（用户名、姓名、邮箱、角色）
- [x] 实现添加教师功能（表单对话框）
- [ ] 实现编辑教师功能（修改信息和角色）
- [ ] 实现删除教师功能（确认对话框）
- [ ] 实现重置密码功能
- [x] 添加权限控制（只有管理员可访问）
- [x] 在导航菜单中添加教师管理入口
- [x] 测试教师管理功能（登录、列表、添加）

## 教师角色设计修正
- [x] 修改数据库schema：教师表的role改为系统权限角色（admin/teacher）
- [x] 修改数据库schema：试卷模板表添加creator_id（出卷老师）和grader_id（阅卷老师）字段
- [x] 更新后端API：修改教师管理相关API的角色定义
- [ ] 更新后端API：试卷模板 API支持教师分配（待试卷模板页面开发时实现）
- [x] 修改教师管理页面：角色选择改为管理员/普通教师
- [ ] 修改试卷模板页面：添加出卷老师和阅卷老师选择器（待试卷模板页面开发时实现）
- [x] 更新单元测试以匹配新的角色定义
- [x] 测试教师管理功能：角色显示和创建功能正常

## 考试管理功能开发
- [x] 完善后端API：考试的创建、编辑、删除、列表查询
- [x] 创建考试管理页面组件
- [x] 实现考试列表展示（名称、学年、学期、状态、日期）
- [x] 实现创建考试功能（表单对话框）
- [x] 实现编辑考试功能
- [x] 实现删除考试功能（确认对话框）
- [x] 实现考试状态管理（草稿、进行中、已完成、已归档）
- [x] 在导航菜单中添加考试管理入口
- [x] 编写考试管理的单元测试

## 试卷管理功能开发
- [x] 完善后端API：试卷的创建、编辑、删除、列表查询（按考试筛选）
- [x] 完善后端API：获取所有教师列表供选择
- [x] 创建试卷管理页面组件
- [x] 实现试卷列表展示（名称、科目、年级、出卷老师、阅卷老师）
- [x] 实现创建试卷功能（选择考试、科目、年级、出卷老师、阅卷老师）
- [x] 实现编辑试卷功能（可修改教师分配）
- [x] 实现删除试卷功能
- [x] 在导航菜单中添加试卷管理入口
- [x] 编写试卷管理的单元测试

## 试卷管理功能优化
- [x] 调试并修复考试下试卷列表页面的创建试卷错误
- [x] 实现从试卷库选择已有试卷关联到考试的功能
- [x] 添加“关联试卷”按钮和对话框
- [x] 显示未关联到当前考试的试卷列表供选择
- [x] 实现试卷关联到考试的API和前端逻辑
- [x] 测试创建新试卷和关联已有试卷两种方式

## 试卷题目管理功能开发
- [x] 完善后端API：题目的创建、编辑、删除、列表查询（按试卷筛选）
- [x] 创建试卷详情页面组件
- [x] 实现题目列表展示（题号、知识模块、知识点、题型、分值）
- [x] 实现添加题目功能（表单对话框）
- [x] 实现编辑题目功能
- [x] 实现删除题目功能（确认对话框）
- [x] 在试卷列表中添加“查看题目”按钮
- [ ] 编写题目管理的单元测试
- [x] 测试完整流程：创建试卷 -> 添加题目 -> 编辑题目 -> 删除题目

## 成绩单PDF导出功能开发
- [x] 设计成绩单布局（A4纸两面，正面和反面）
- [x] 确定正面内容：学生信息、考试信息、各科成绩表格
- [x] 确定反面内容：成绩统计、评语、签名栏等
- [x] 实现后端PDF生成API（使用weasyprint或puppeteer）
- [x] 精确控制页面大小和边距，确保正好2页
- [x] 实现前端成绩单导出按钮和界面
- [ ] 测试不同科目数量下的排版效果
- [ ] 验证PDF可以正常双面打印
- [ ] 编写成绩单导出的单元测试

## 简化用户操作（保留classes和subjects表）
- [x] 回滚数据库schema修改，恢复classId和subjectId字段
- [x] 修复TypeScript错误
- [ ] 优化Students页面：支持直接输入班级名称，系统自动创建或匹配
- [ ] 优化ExamTemplates页面：支持直接输入科目名称，系统自动创建或匹配
- [ ] 测试优化后的功能
