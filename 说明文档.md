# 橡心国际 Way To Future 考试管理系统 - 说明文档

## 项目进度记录

| 日期 | 任务 | 状态 | 说明 |
| :--- | :--- | :--- | :--- |
| 2025-12-28 | **系统重构与数据重置** | [完成] | 1. 清空所有旧数据。 <br> 2. 创建4场标准考试场次 (1.4/1.11 上午/下午)。 <br> 3. 导入所有试卷模版 (28套 x 4场)。 <br> 4. 导入所有考生报考信息 (OCR数据录入)。 |
| 2025-12-28 | 修复 `ExamTemplate` 模型字段 | [完成] | 修正了 `total_score` 和 `passing_score` 字段不存在的问题，改为 `total_questions`。 |
| 2025-12-28 | 完善 `User` 和 `Student` 模型初始化 | [完成] | 修正了 `User` 创建时的多余参数，并在创建 `Student` 时补充了 `gender` 字段。 |
| 2025-12-28 | 前端导航与部署优化 | [完成] | 修复导航栏链接，创建启动脚本。 |
| 2025-12-28 | 考生报考信息校对 | [完成] | 编写 `verify_wang_wenyi.py` 脚本，核实了王雯仪的报考信息（G3，3门课）。 |
| 2025-12-28 | 清理测试数据 | [完成] | 编写 `cleanup_test_data.py` 删除了8条测试学生数据。 |
| 2025-12-28 | **成绩单功能完善** | [完成] | 1. 修复中文乱码。 <br> 2. 实现多学科合并显示。 <br> 3. 新增能力雷达图 (基于知识模块)。 <br> 4. 新增AI/教师评语及签字区。 <br> 5. 集成Logo显示。 |
| 2025-12-28 | **修复成绩单PDF下载Bug** | [完成] | 修正了成绩单下载链接使用学号(如20269440)导致查询失败的问题 (系统原默认使用数据库ID)。现已支持同时通过数据库ID或学号查询。 |
| 2025-12-28 | **优化成绩单预览体验** | [完成] | 1. 调整 `pdf_report_card` 接口，支持 `action=download` 参数。 <br> 2. 默认请求改为浏览器在线预览 (inline)，点击下载按钮才强制下载 (attachment)。 |
| 2025-12-28 | **登分管理功能优化** | [完成] | 1. 修复分数保存逻辑：从“删除所有重写”改为“按题目更新(Upsert)”，解决了录入一门科目成绩导致其他科目成绩丢失的严重Bug。 <br> 2. 优化题目排序：录入界面题目按自然顺序 (Q1, Q2, Q10) 排列。 <br> 3. 动态加载科目列表：前端科目筛选现可实时获取系统已有科目。 |
| 2025-12-28 | **界面导航优化** | [完成] | 1. 全面修复所有业务页面的导航栏，添加“评分录入”及补全“报考管理”入口。 <br> 2. 覆盖页面包括：首页、仪表板、考生管理、考试管理等全站页面。 <br> 3. 在首页(Home)新增“评分录入”快捷卡片，提升入口可见性。 |
| 2025-12-28 | **账号维护** | [完成] | 1. 重置管理员账号 `admin` 的密码为 `admin123`，修复无法登录的问题。 |
| 2025-12-28 | **登分筛选逻辑重构** | [完成] | 1. 将评分录入页面的筛选逻辑从“场次+年级”改为直接“选择试卷(ExamTemplate)”。 <br> 2. 移除场次和年级筛选，保留并优化学生搜索功能。 <br> 3. 后端新增 `/api/students/by-template/<id>` 接口，支持跨场次聚合同一试卷的所有考生。 |
| 2025-12-28 | **登分交互流程优化** | [完成] | 1. 新增“考生列表”视图，选择试卷后先展示该试卷所有考生清单。 <br> 2. 支持在列表中查看录入状态(已录入/未录入)并筛选考生。 <br> 3. 点击考生进入录入界面，支持“返回列表”及“上一个/下一个”快速切换。 |
| 2025-12-28 | **系统稳定性修复** | [完成] | 1. 修复因移除“评分录入”功能导致的全局 500 错误。 <br> 2. 批量清理 9 个模板文件中残留的 `url_for('score_entry')` 调用。 <br> 3. 统一将已禁用功能的导航链接替换为占位符并注释。 |
| 2025-12-29 | **评分录入功能重构** | [完成] | 1. 重建后端核心 API，支持跨场次试卷聚合、批量分数保存 (Upsert) 及题目自然排序。 <br> 2. 重建前端交互：新增“选择试卷”仪表板、“考生列表”页及“评分录入”页 (支持上一页/下一页导航)。 <br> 3. 通过单元测试 `test_score_entry.py` 验证了完整业务流程。 |
| 2025-12-29 | **修复 500 Error 及导航恢复** | [完成] | 1. 修复后端路由 `exam_templates` 命名冲突导致的启动失败 (AssertionError)。 <br> 2. 确认 `exam_templates` (试卷管理) 和 `question_templates` (题目模板) 双路由共存。 <br> 3. 恢复全站“评分录入”导航链接。 |
| 2025-12-29 | **评分录入Bug修复** | [完成] | 1. 修复考生列表页因字段名不匹配 (`student_id` vs `id`) 导致的 404 跳转错误。 <br> 2. 修正学号显示为数据库ID的问题。 <br> 3. 解决系统卡顿问题并重启服务。 |
| 2025-12-29 | **新增教师管理功能** | [完成] | 1. 更新 User 模型，支持英文名、真实姓名。 <br> 2. 新增教师管理页面 (Admin专用)，支持CRUD。 <br> 3. 试卷管理支持分配“出卷老师”和“阅卷老师”。 <br> 4. 实现权限控制：阅卷老师只能在评分录入中看到分配给自己的试卷。 |

## 当前系统状态
- **考试场次**: 4场 (1.4 上/下, 1.11 上/下)
- **试卷模版**: 覆盖 G1-G6 语数英及 AMC8/袋鼠/小托福
- **考生数据**: 已导入所有提供的考生及报考信息
- **服务状态**: 运行中 (Port 8083)

## 下一步计划
- [ ] 等待用户验收测试

## 2025-12-28 评分录入功能变更
- [x] **移除功能**: 
  - 根据用户要求，彻底移除评分录入功能（包括界面和API接口）。
  - 后续计划重构此功能。
- [x] **清理代码**: 
  - 删除 `score_entry.html` 模板。
  - 移除 `wtf_app_simple.py` 中的 `score_entry`, `api_students_by_template`, `api_save_scores`, `api_import_scores` 等路由。
  - 隐藏首页和导航栏的评分录入入口。
